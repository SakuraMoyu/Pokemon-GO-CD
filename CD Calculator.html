<!doctype html>

<html lang="en">
<head>
  <meta charset="utf-8">

  <title>Fast IV Lookup</title>
  <meta name="description" content="Fast IV Lookup">
  <meta name="author" content="SakuraMoyu">

  

</head>

<body>

<p id="csv_instruction">Please select pokémon base stat csv file for calculation:</p>
<input id="csv" type="file">

<br/>

<form id="Query" style="visibility:hidden;">
    <table>
        <tr>
            <th>
                <p>Pokémon:</p>
            </th>
        </tr>
        <tr>
            <td>
                <p>Species:</p>
            </td>
            <td>
                <select id="species">
                    <option value="none">N/A</option>
                </select>
            </td>
        </tr>
        <tr>
            <th>
                <p>Custom stats:</p>
            </th>
        </tr>        
        <tr>
            <td>
                <p>Base Attack:</p>
            </td>
            <td>
                <input size="3" maxlength="3" value="0" type="number" min="1" max="999" id="go_base_atk" style="width: 60px;">
            </td>                    
        </tr>
        <tr>
            <td>
                <p>Base Defense:</p>
            </td>
            <td>
                <input size="3" maxlength="3" value="0" type="number" min="1" max="999" id="go_base_def" style="width: 60px;">
            </td>                     
        </tr>        
        <tr>   
            <td>
                <p>Base Stamina:</p>
            </td>
            <td>
                <input size="3" maxlength="3" value="0" type="number" min="1" max="999" id="go_base_sta" style="width: 60px;">
            </td>                     
        </tr>        
        <br/>
        <tr>
            <th>
                <p>IVs:</p>
            </th>
        </tr>
        <tr>
            <td>
                <p>Attack IV:</p>
            </td>
            <td>
                <select id="atk_range">
                    <option value="0">&#62;=</option>
                    <option value="1">=</option>
                    <option value="2">&#60;=</option>
                </select>
                <select id="atk_iv">
                    <option selected value="-1">Don't care</option>
                    <option value="0">0</option>
                    <option value="1">1</option>
                    <option value="2">2</option>
                    <option value="3">3</option>
                    <option value="4">4</option>
                    <option value="5">5</option>
                    <option value="6">6</option>
                    <option value="7">7</option>
                    <option value="8">8</option>
                    <option value="9">9</option>
                    <option value="10">10</option>
                    <option value="11">11</option>
                    <option value="12">12</option>
                    <option value="13">13</option>
                    <option value="14">14</option>
                    <option value="15">15</option>
                </select>
            </td>
        </tr>
        <tr>
            <td>
                <p>Defense IV:</p>
            </td>
            <td>
                <select id="def_range">
                    <option value="0">&#62;=</option>
                    <option value="1">=</option>
                    <option value="2">&#60;=</option>
                </select>
                <select id="def_iv">
                    <option selected value="-1">Don't care</option>
                    <option value="0">0</option>
                    <option value="1">1</option>
                    <option value="2">2</option>
                    <option value="3">3</option>
                    <option value="4">4</option>
                    <option value="5">5</option>
                    <option value="6">6</option>
                    <option value="7">7</option>
                    <option value="8">8</option>
                    <option value="9">9</option>
                    <option value="10">10</option>
                    <option value="11">11</option>
                    <option value="12">12</option>
                    <option value="13">13</option>
                    <option value="14">14</option>
                    <option value="15">15</option>
                </select>
            </td>
        </tr>
        <tr>
            <td>
                <p>Stamina IV:</p>
            </td>
            <td>
                <select id="sta_range">
                    <option value="0">&#62;=</option>
                    <option value="1">=</option>
                    <option value="2">&#60;=</option>
                </select>
                <select id="sta_iv">
                    <option selected value="-1">Don't care</option>
                    <option value="0">0</option>
                    <option value="1">1</option>
                    <option value="2">2</option>
                    <option value="3">3</option>
                    <option value="4">4</option>
                    <option value="5">5</option>
                    <option value="6">6</option>
                    <option value="7">7</option>
                    <option value="8">8</option>
                    <option value="9">9</option>
                    <option value="10">10</option>
                    <option value="11">11</option>
                    <option value="12">12</option>
                    <option value="13">13</option>
                    <option value="14">14</option>
                    <option value="15">15</option>
                </select>
            </td>
        </tr>
        <tr>
            <td>
                <p>Total IV:</p>
            </td>
            <td>
                <select id="sum_range">
                    <option value="0">&#62;=</option>
                    <option value="1">=</option>
                    <option value="2">&#60;=</option>
                </select>
                <select id="sum_iv">
                    <option selected value="-1">Don't care</option>
                    <option value="0">0</option>
                    <option value="1">1</option>
                    <option value="2">2</option>
                    <option value="3">3</option>
                    <option value="4">4</option>
                    <option value="5">5</option>
                    <option value="6">6</option>
                    <option value="7">7</option>
                    <option value="8">8</option>
                    <option value="9">9</option>
                    <option value="10">10</option>
                    <option value="11">11</option>
                    <option value="12">12</option>
                    <option value="13">13</option>
                    <option value="14">14</option>
                    <option value="15">15</option>
                    <option value="16">16</option>
                    <option value="17">17</option>
                    <option value="18">18</option>
                    <option value="19">19</option>
                    <option value="20">20</option>
                    <option value="21">21</option>
                    <option value="22">22</option>
                    <option value="23">23</option>
                    <option value="24">24</option>
                    <option value="25">25</option>
                    <option value="26">26</option>
                    <option value="27">27</option>
                    <option value="28">28</option>
                    <option value="29">29</option>
                    <option value="30">30</option>
                    <option value="31">31</option>
                    <option value="32">32</option>
                    <option value="33">33</option>
                    <option value="34">34</option>
                    <option value="35">35</option>
                    <option value="36">36</option>
                    <option value="37">37</option>
                    <option value="38">38</option>
                    <option value="39">39</option>
                    <option value="40">40</option>
                    <option value="41">41</option>
                    <option value="42">42</option>
                    <option value="43">43</option>
                    <option value="44">44</option>
                    <option value="45">45</option>
                </select>
            </td>
        </tr>
        <tr>
            <td>
                <p>Appraisal:</p>
            </td>
            <td>
                <select id="appraisal_range">
                    <option selected value="-1">Don't care</option>
                    <option value="0">0-22/0%-48.9%</option>
                    <option value="1">23-29/51.1%-64.4%</option>
                    <option value="2">30-36/66.7%-80%</option>
                    <option value="3">37-45/82.2%-100%</option>                 
                </select>
            </td>
        </tr>        
        <tr>
            <th>
                <p>Accuracy:</p>
            </th>
        </tr>
        <tr>
            <th>
                <p>Minimum accuracy with CP known:</p> 
            </th>
        </tr>
        <tr>
            <td>
                Accuracy: <span id="cp_accuracy_value"></span>%                               
            </td>
            <td>
                <input type="range" min="0" max="100" value="80" class="slider" id="cp_accuracy"> 
            </td>
        </tr>
        <tr>
            <th>
                <p>Minimum accuracy with HP and power up dust cost known:</p> 
            </th>
        </tr>
        <tr>
            <td>
                Accuracy: <span id="summary_accuracy_value"></span>%                               
            </td>
            <td>
                <input type="range" min="0" max="100" value="80" class="slider" id="summary_accuracy"> 
            </td>
        </tr>
        <tr>
            <th>
                <p>Minimum accuracy with appraisal result known:</p> 
            </th>
        </tr>
        <tr>
            <td>
                Accuracy: <span id="appraisal_accuracy_value"></span>%                               
            </td>
            <td>
                <input type="range" min="0" max="100" value="80" class="slider" id="appraisal_accuracy"> 
            </td>
        </tr>
        <tr>
            <th>
                <p>Minimum accuracy with level known:</p> 
            </th>
        </tr>
        <tr>
            <td>
                Accuracy: <span id="level_accuracy_value"></span>%                               
            </td>
            <td>
                <input type="range" min="0" max="100" value="80" class="slider" id="level_accuracy"> 
            </td>
        </tr>        
    </table>
 
    <button type="button" onclick="calculation()">Start Calculation!</button>
   
</form>

<p id="expected_value" style="visibility:hidden;"/>

<form id="compact_table" style="visibility:hidden;">
    <button type="button" onclick="show_compact_list()">Show Compact List</button>
</form>

<table id="summarized_result" style="display:none;">
</table>

<p id="coarse_search_string" style="display:none;"/>

<p id="fine_search_string" style="display:none;"/>
 
<p id="level_search_string" style="display:none;"/>

<table id="result" style="visibility:hidden;">
</table>

<script type="text/javascript">
    var pokemon_list;
    var pokemon_stat_array;
    var pokemon_stat_row;
    var pokemon_namelist;
    var pokedex;
    var cpm = [0.094,
0.135137432,
0.16639787,
0.192650919,
0.21573247,
0.236572661,
0.25572005,
0.273530381,
0.29024988,
0.306057377,
0.3210876,
0.335445036,
0.34921268,
0.362457751,
0.37523559,
0.387592406,
0.39956728,
0.411193551,
0.42250001,
0.432926419,
0.44310755,
0.4530599578,
0.46279839,
0.472336083,
0.48168495,
0.4908558,
0.49985844,
0.508701765,
0.51739395,
0.525942511,
0.53435433,
0.542635767,
0.55079269,
0.558830576,
0.56675452,
0.574569153,
0.58227891,
0.589887917,
0.59740001,
0.604818814,
0.61215729,
0.619399365,
0.62656713,
0.633644533,
0.64065295,
0.647576426,
0.65443563,
0.661214806,
0.667934,
0.674577537,
0.68116492,
0.687680648,
0.69414365,
0.700538673,
0.70688421,
0.713164996,
0.71939909,
0.725571552,
0.7317,
0.734741009,
0.73776948,
0.740785574,
0.74378943,
0.746781211,
0.74976104,
0.752729087,
0.75568551,
0.758630378,
0.76156384,
0.764486065,
0.76739717,
0.770297266,
0.7731865,
0.776064962,
0.77893275,
0.781790055,
0.78463697,
0.787473578,
0.79030001]

    var species = document.getElementById("species"),
    
    go_base_stat_cal = function () {
        pokemon_entry_no = parseInt(species.value);
        var go_base_stat = go_msg_stat_conversion(pokemon_entry_no);
        go_base_atk.value = go_base_stat[1];
        go_base_def.value = go_base_stat[2];
        go_base_sta.value = go_base_stat[0];
    };

    species.addEventListener('change', go_base_stat_cal);
    
    var base_atk_box = document.getElementById("go_base_atk");
    var base_def_box = document.getElementById("go_base_def");
    var base_sta_box = document.getElementById("go_base_sta"); 
    
    var attack_equality = document.getElementById("atk_range");
    var attack_iv = document.getElementById("atk_iv");
    
    var defense_equality = document.getElementById("def_range");
    var defense_iv = document.getElementById("def_iv");
    
    var hp_equality = document.getElementById("sta_range");
    var hp_iv = document.getElementById("sta_iv");
    
    var sum_equality = document.getElementById("sum_range");
    var sum_iv = document.getElementById("sum_iv");
    
    var appraisal_range = document.getElementById("appraisal_range");

    var cp_slider = document.getElementById("cp_accuracy");
    var cp_slider_visualize = document.getElementById("cp_accuracy_value");
    
    var summary_slider = document.getElementById("summary_accuracy");
    var summary_slider_visualize = document.getElementById("summary_accuracy_value");
    
    var appraisal_slider = document.getElementById("appraisal_accuracy");
    var appraisal_slider_visualize = document.getElementById("appraisal_accuracy_value");
    
    var level_slider = document.getElementById("level_accuracy");
    var level_slider_visualize = document.getElementById("level_accuracy_value");
    
    var power_up_cost = [];
    var max_cp = [];
    var actual_bound = 0;
    
    var candidate_cp = [];
    
    var result_table = document.getElementById("result");
    
    var no_of_combination = 0;
    var no_of_combination_weather = 0;
    var no_of_combination_friend = 0;
    var no_of_combination_lucky = 0;
    var expected_value = 0;
    var expected_value_weather = 0;
    var expected_value_friend = 0;
    var expected_value_lucky = 0;
    
    var expected_value_text = document.getElementById("expected_value");
    
    var compact_table = document.getElementById("compact_table");
    var summarized_result = document.getElementById("summarized_result");
    
    var coarse_search_string = document.getElementById("coarse_search_string");
    
    var fine_search_string = document.getElementById("fine_search_string");
    
    var level_search_string = document.getElementById("level_search_string");
    
    var result_table = document.getElementById("result");
    
    var melmetal = 0;
    
    var fileInput = document.getElementById("csv"),

    readFile = function () {
        var reader = new FileReader();
        reader.onload = function () {
            pokemon_stat_array = [];
            pokemon_namelist = [];
            pokedex = [];
            pokemon_stat_table = reader.result.split('\n');
            //Here we expect the first line is titles of columns
            for (var count = 1; count < pokemon_stat_table.length; ++count){
                pokemon_stat = pokemon_stat_table[count].split(','); 
                pokemon_stat_row = [];
                pokedex[count-1] = pokemon_stat[0];
                pokemon_namelist[count-1] = pokemon_stat[1];
                if (pokemon_stat[0] == "Melmetal") {
                    melmetal = count-1;
                }
                for (var count_nested = 2; count_nested < pokemon_stat.length; ++count_nested){        
                    pokemon_stat_row[count_nested-2] = parseInt(pokemon_stat[count_nested]);                    
                }
                pokemon_stat_array[count-1] = pokemon_stat_row;
    	    }
    	    var csv_text = document.getElementById("csv_instruction");
    	    var csv = document.getElementById("csv");
    	    var form = document.getElementById("Query");
    	    csv_text.style.display = 'none';
    	    csv.style.display = 'none';
    	    form.style.visibility = "visible";
    	    var dropdown = "";
    	    for (var count = 0; count < pokemon_namelist.length; ++count){
                dropdown = dropdown + "<option value=" + '\"' + count + '\"' + ">" + pokemon_namelist[count] + "</option>";
    	    }
    	    species.innerHTML = dropdown;
        };
        // start reading the file. When it is done, calls the onload event defined above.
        reader.readAsBinaryString(fileInput.files[0]);
    };   
    
    fileInput.addEventListener('change', readFile);    

    cp_slider_visualize.innerHTML = cp_slider.value;
    cp_slider.oninput = function() {
      cp_slider_visualize.innerHTML = this.value;
    }
    
    summary_slider_visualize.innerHTML = summary_slider.value;
    summary_slider.oninput = function() {
      summary_slider_visualize.innerHTML = this.value;
    }
    
    appraisal_slider_visualize.innerHTML = appraisal_slider.value;
    appraisal_slider.oninput = function() {
      appraisal_slider_visualize.innerHTML = this.value;
    }
    
    level_slider_visualize.innerHTML = level_slider.value;
    level_slider.oninput = function() {
      level_slider_visualize.innerHTML = this.value;
    }
    
    function calculation() {
        power_up_cost = [];
        max_cp = [];
        actual_bound = 0;
        no_of_combination = 0;
        no_of_combination_weather = 0;
        no_of_combination_friend = 0;
        no_of_combination_lucky = 0;
        expected_value = 0;
        expected_value_weather = 0;
        expected_value_friend = 0;
        expected_value_lucky = 0;
        result_table.innerHTML = "";
        summarized_result.innerHTML = "";
        coarse_search_string.innerHTML = "";
        fine_search_string.innerHTML = "";
        level_search_string.innerHTML = "";
        var pokemon_entry_no = parseInt(species.value);
        var go_base_stat = [parseInt(go_base_sta.value), parseInt(go_base_atk.value), parseInt(go_base_def.value)];
        //go_base_stat = go_msg_stat_conversion(pokemon_entry_no);
        var constrain_tensor = generate_constrain_matrix();  
        if (no_of_combination == 0) {
            alert("No target IV can be generated, please check if the IVs constrains are contradicting with each others.");
            return;
        }
        var cp_iv_hash_map = go_cp_calculation(go_base_stat, constrain_tensor);
        table_generation(go_base_stat, cp_iv_hash_map, cp_slider.value, 0);
        table_generation(go_base_stat, cp_iv_hash_map, summary_slider.value, 1);
        table_generation(go_base_stat, cp_iv_hash_map, appraisal_slider.value, 2);
        table_generation(go_base_stat, cp_iv_hash_map, level_slider.value, 3);
        result_table.style.visibility = "visible";
        expected_value = Math.ceil(4096/no_of_combination);
        if (no_of_combination_weather == 0) {
            expected_value_weather = false;
        } else {
            expected_value_weather = Math.ceil(1728/no_of_combination_weather);
        }
        if (no_of_combination_friend == 0) {
            expected_value_friend = false;
        } else {
            expected_value_friend = Math.ceil(1331/no_of_combination_friend);
        }
        if (no_of_combination_lucky == 0) {
            expected_value_lucky = false;
        } else {
            expected_value_lucky = Math.ceil(64/no_of_combination_lucky);
        }        
        var expected_value_message = "Expected no of catch needed to get one candidate " + pokemon_namelist[pokemon_entry_no] + " without weather boost: " + expected_value + "<br/>";
        if (expected_value_weather) {
            expected_value_message = expected_value_message + "Expected no of catch needed to get one candidate " + pokemon_namelist[pokemon_entry_no] + " with weather boost: " + expected_value_weather + "<br/>";
        } else {
            expected_value_message = expected_value_message + "No " + pokemon_namelist[pokemon_entry_no] + " shown in weather boost will meet the criteria. Please try again with different settings. <br/>";
        }
        if (expected_value_friend) {
            expected_value_message = expected_value_message + "Expected no of trade with best friend to get one candidate " + pokemon_namelist[pokemon_entry_no] + ": " + expected_value_friend + "<br/>";
        } else {
            expected_value_message = expected_value_message + "No " + pokemon_namelist[pokemon_entry_no] + " received from your best friend will meet the criteria. Please try again with different settings. <br/>";
        }        
        if (expected_value_lucky) {
            expected_value_message = expected_value_message + "Expected no of lucky trade to get one candidate " + pokemon_namelist[pokemon_entry_no] + ": " + expected_value_lucky + "<br/>";
        } else {
            expected_value_message = expected_value_message + "No " + pokemon_namelist[pokemon_entry_no] + " received from lucky trade will meet the criteria. Please try again with different settings. <br/>";
        }
        expected_value_text.innerHTML = expected_value_message;
        expected_value_text.style.visibility = "visible";
        compact_table.style.visibility = "visible";
        return;
    } 
    
    function go_msg_stat_conversion(pokemon_entry_no) {
        var msg_stat = pokemon_stat_array[pokemon_entry_no];
        var speedmod = 1+((msg_stat[5]-75)/500);
        var mixed_attack = Math.round(((Math.max(msg_stat[1], msg_stat[3])*7/8) + (Math.min(msg_stat[1], msg_stat[3])*1/8))*2);
        var theory_attack = Math.round(mixed_attack*speedmod);
        var mixed_defense = Math.round(((Math.max(msg_stat[2], msg_stat[4])*5/8) + (Math.min(msg_stat[2], msg_stat[4])*3/8))*2);
        var theory_defense = Math.round(mixed_defense*speedmod);
        var theory_hp = Math.floor(50+1.75*msg_stat[0]);
        var theory_max_cp = Math.floor((theory_attack+15)*Math.sqrt(theory_defense+15)*Math.sqrt(theory_hp+15)*Math.pow(cpm[78],2)/10);
        //alert([speedmod,mixed_attack, theory_attack,mixed_defense,theory_defense,theory_hp,theory_max_cp]);
        if (theory_max_cp < 4000) {
            var go_base_stat = [theory_hp, theory_attack, theory_defense];
            return go_base_stat;
        } else {
            var circle_9_nerf_attack = Math.round(mixed_attack*speedmod*0.91);
            var circle_9_nerf_defense = Math.round(mixed_defense*speedmod*0.91);
            var circle_9_nerf_hp = Math.round((50+1.75*msg_stat[0])*0.91);
            if (pokemon_entry_no == melmetal) {
                circle_9_nerf_hp = 264;
            }
            var go_base_stat = [circle_9_nerf_hp, circle_9_nerf_attack, circle_9_nerf_defense];
            return go_base_stat;
        }
    }
    
    function generate_constrain_matrix() {
        var constrain_tensor = [];
        var sum_constrain = sum_equality.value;
        var sum_bound = parseInt(sum_iv.value);
        var appraisal_constrain = parseInt(appraisal_range.value);
        for (var atk = 0; atk < 16; ++atk){
            var constrain_matrix = [];
            var atk_bound = parseInt(attack_iv.value);
            if (atk_bound != -1) {
                switch (attack_equality.value) {
                    case "0":
                        if (atk < atk_bound) {
                            continue;
                        }
                        break;
                    case "1":
                        if (atk != atk_bound) {
                            continue;
                        }
                        break;
                    default:
                        if (atk > atk_bound) {
                            continue;
                        }
                        break;                
                }
            }
            for (var def = 0; def < 16; ++def){
                constrain_list = [];
                var def_bound = parseInt(defense_iv.value);
                if (def_bound != -1) {
                    switch (defense_equality.value) {
                        case "0":
                            if (def < def_bound) {
                                continue;
                            }
                            break;
                        case "1":
                            if (def != def_bound) {
                                continue;
                            }
                            break;
                        default:
                            if (def > def_bound) {
                                continue;
                            }
                            break;                
                    }
                }
                for (var hp = 0; hp < 16; ++hp){
                    var hp_bound = parseInt(hp_iv.value);
                    if (hp_bound != -1) {
                        switch (hp_equality.value) {
                            case "0":
                                if (hp < hp_bound) {
                                    constrain_list[hp] = false;
                                    continue;
                                }
                                break;
                            case "1":
                                if (hp != hp_bound) {
                                    constrain_list[hp] = false;
                                    continue;
                                }
                                break;
                            default:
                                if (hp > hp_bound) {
                                    constrain_list[hp] = false;
                                    continue;
                                }
                                break;                
                        }
                    }
                    iv_total = atk+def+hp;
                    if (sum_bound != -1) {
                        switch (sum_constrain) {
                            case "0":
                                if (iv_total < sum_bound) {
                                    constrain_list[hp] = false;
                                    continue;
                                }
                                break;
                            case "1":
                                if (iv_total != sum_bound) {
                                    constrain_list[hp] = false;
                                    continue;
                                }
                                break;
                            default:
                                if (iv_total > sum_bound) {
                                    constrain_list[hp] = false;
                                    continue;
                                }
                                break;                
                        }
                    }
                    switch (appraisal_constrain) {
                        case 0:
                            if (22 < iv_total) {
                                constrain_list[hp] = false;
                                continue;
                            }
                            break;
                        case 1:
                            if ((29 < iv_total)||(iv_total < 23)) {
                                constrain_list[hp] = false;
                                continue;
                            }
                            break;
                        case 2:
                            if ((36 < iv_total)||(iv_total < 30)) {
                                constrain_list[hp] = false;
                                continue;
                            }
                            break;
                        case 3:
                            if (iv_total < 37) {
                                constrain_list[hp] = false;
                                continue;
                            }
                            break;                                                                           
                    
                    }
                    constrain_list[hp] = true;
                    ++no_of_combination;                      
                    if ((def >= 4) && (atk >= 4) && (hp >= 4)) {
                        ++no_of_combination_weather;
                    }  
                    if ((def >= 5) && (atk >= 5) && (hp >= 5)) {
                        ++no_of_combination_friend;
                    }   
                    if ((def >= 12) && (atk >= 12) && (hp >= 12)) {
                        ++no_of_combination_lucky;
                    }                                                 
                }
                constrain_matrix[def] = constrain_list;
            }
            constrain_tensor[atk] = constrain_matrix;
        }
        return constrain_tensor;
    }    
    
    function go_cp_calculation(go_base_stat, constrains) {
        var dust = 0;
        var cp_iv_map = [];
        for (var level = 0; level < 35; ++level){
            if (level % 2 == 0) {
                if (level < 10) {
                    dust += 200;
                } else if (level < 20) {
                    dust += 300;
                } else if (level < 30) {
                    dust += 500;
                } else {
                    dust += 1000;
                }
                power_up_cost.push(dust);
            }
            for (var attack = 0; attack < 16; ++attack){
                for (var defense = 0; defense < 16; ++defense){
                    for (var hp = 0; hp < 16; ++hp){
                        var cp = Math.max(10, Math.floor((go_base_stat[1]+attack)*Math.sqrt(go_base_stat[2]+defense)*Math.sqrt(go_base_stat[0]+hp)*Math.pow(cpm[level*2],2)/10));
                        var actual_hp = Math.floor((go_base_stat[0]+hp)*cpm[level*2]);
                        if ((attack == 15) && (defense == 15) && (hp == 15)) {
                            max_cp.push(cp);                       
                        }
                        if (typeof cp_iv_map[cp] == 'undefined') {
                            if (typeof constrains[attack] == 'undefined') {
                                cp_iv_map[cp] = [];
                                cp_iv_map[cp].push(false);
                                var state = [level, dust, attack, defense, hp, actual_hp, false];
                                cp_iv_map[cp].push(state); 
                            } else if (typeof constrains[attack][defense] == 'undefined') {
                                cp_iv_map[cp] = [];
                                cp_iv_map[cp].push(false);
                                var state = [level, dust, attack, defense, hp, actual_hp, false];
                                cp_iv_map[cp].push(state); 
                            } else if (constrains[attack][defense][hp] == true) {
                                cp_iv_map[cp] = [];
                                cp_iv_map[cp].push(true);
                                var state = [level, dust, attack, defense, hp, actual_hp, true];
                                cp_iv_map[cp].push(state);                               
                            } 
                        } else {
                            if (typeof constrains[attack] == 'undefined') {
                                var crash = [level, dust, attack, defense, hp, actual_hp, false];
                                cp_iv_map[cp].push(crash);
                            } else if (typeof constrains[attack][defense] == 'undefined') {
                                var crash = [level, dust, attack, defense, hp, actual_hp, false];
                                cp_iv_map[cp].push(crash);
                            } else if (constrains[attack][defense][hp] == true) {
                                cp_iv_map[cp][0] = true;
                                var crash = [level, dust, attack, defense, hp, actual_hp, true];
                                cp_iv_map[cp].push(crash);                            
                            } else {
                                var crash = [level, dust, attack, defense, hp, actual_hp, false];
                                cp_iv_map[cp].push(crash);
                            }
                        }
                    }
                }
            }
        }
        for (var cp = 0; cp < cp_iv_map.length; ++cp) {
            if (typeof cp_iv_map[cp] == 'undefined') {
                continue;
            } else {
                if (cp_iv_map[cp][0]) {
                    cp_iv_map[cp].shift();
                } else {
                    cp_iv_map[cp] = [];
                }               
            } 
        }
        return cp_iv_map;
    }
    
    function table_generation(go_base_stat, cp_iv_hash_map, constrain_accuracy, mode) {
        candidate_cp = [];
        write_table_header(mode);
        write_summarized_table_header(mode);
        for (var cp = 0; cp < 5000; ++cp){
            if (typeof cp_iv_hash_map[cp] == 'undefined') {
                continue;
            }
            switch (mode) {
                case 0:
                    var true_positive = 0;
                    for (var crash = 0; crash < cp_iv_hash_map[cp].length; ++crash){
                        if (cp_iv_hash_map[cp][crash][6]) {
                            ++true_positive;
                        }
                    }
                    var accuracy = true_positive*100/cp_iv_hash_map[cp].length;
                    if (accuracy > constrain_accuracy) {
                        candidate_cp.push(cp);
                        var data = [cp, true_positive, cp_iv_hash_map[cp].length, accuracy];
                        generate_table_row(data, mode);
                    }
                    break; 
                case 1:
                case 2: 
                case 3:                    
                    var checked = [];                              
                    for (var crash = 0; crash < cp_iv_hash_map[cp].length; ++crash){
                        var stat = [];
                        if (cp_iv_hash_map[cp][crash][6]) {
                            if (typeof checked[crash] == 'undefined') {
                                var true_positive = 1;
                                var no_of_crash = 1;
                                checked[crash] = true;
                                stat.push(cp_iv_hash_map[cp][crash]);
                                for (var crash_forward = 0; crash_forward < cp_iv_hash_map[cp].length; ++crash_forward){
                                    if (typeof checked[crash_forward] != 'undefined') {
                                        continue;
                                    } else {
                                        var check_stat = cp_iv_hash_map[cp][crash_forward];
                                        var appraisal_crash = appraisal(cp_iv_hash_map[cp][crash][2], cp_iv_hash_map[cp][crash][3], cp_iv_hash_map[cp][crash][4]);
                                        var appraisal_crash_forward = appraisal(check_stat[2], check_stat[3], check_stat[4]);
                                        var appraisal_result = (appraisal_crash[0] == appraisal_crash_forward[0])&&(appraisal_crash[1] == appraisal_crash_forward[1])&&(appraisal_crash[2] == appraisal_crash_forward[2])&&(appraisal_crash[3] == appraisal_crash_forward[3])&&(appraisal_crash[4] == appraisal_crash_forward[4]);
                                        var mode_1_check = (check_stat[1] == cp_iv_hash_map[cp][crash][1])&&(check_stat[5] == cp_iv_hash_map[cp][crash][5])&&(mode == 1);
                                        var mode_2_check = (check_stat[1] == cp_iv_hash_map[cp][crash][1])&&(check_stat[5] == cp_iv_hash_map[cp][crash][5])&&(appraisal_result)&&(mode == 2);
                                        var mode_3_check = (check_stat[0] == cp_iv_hash_map[cp][crash][0])&&(check_stat[5] == cp_iv_hash_map[cp][crash][5])&&(appraisal_result)&&(mode == 3);
                                        if (mode_1_check || mode_2_check || mode_3_check) {
                                            checked[crash_forward] = true;
                                            if (check_stat[6]) {
                                                ++true_positive;
                                                ++no_of_crash;
                                            } else {
                                                ++no_of_crash;
                                            }
                                            stat.push(cp_iv_hash_map[cp][crash_forward]);
                                        }
                                    }
                                }
                                var accuracy = true_positive*100/no_of_crash;
                                if (accuracy > constrain_accuracy) {
                                    for (var candidate_no = 0; candidate_no < stat.length; ++candidate_no){
                                        var candidate = stat[candidate_no];
                                        var power_up_once = Math.max(10, Math.floor((go_base_stat[1]+candidate[2])*Math.sqrt(go_base_stat[2]+candidate[3])*Math.sqrt(go_base_stat[0]+candidate[4])*Math.pow(cpm[candidate[0]*2+1],2)/10));
                                        var power_up_twice = Math.max(10, Math.floor((go_base_stat[1]+candidate[2])*Math.sqrt(go_base_stat[2]+candidate[3])*Math.sqrt(go_base_stat[0]+candidate[4])*Math.pow(cpm[candidate[0]*2+2],2)/10));
                                        switch (mode) {
                                            case 1:
                                                if (candidate_no == 0) {
                                                    if (typeof candidate_cp[candidate[1]] == 'undefined') {
                                                        candidate_cp[candidate[1]] = [];
                                                        candidate_cp[candidate[1]][candidate[5]] = [];
                                                    } else {
                                                        if (typeof candidate_cp[candidate[1]][candidate[5]] == 'undefined') {
                                                            candidate_cp[candidate[1]][candidate[5]] = [];
                                                        }                                               
                                                    }
                                                    candidate_cp[candidate[1]][candidate[5]].push([cp, candidate[1], candidate[5]]);
                                                    var data = [cp, true_positive, no_of_crash, accuracy, candidate[1], candidate[5]];          
                                                    generate_table_row(data, mode);
                                                }
                                                break;
                                            case 2:
                                                if (typeof candidate_cp[candidate[1]] == 'undefined') {
                                                    candidate_cp[candidate[1]] = [];
                                                    candidate_cp[candidate[1]][candidate[5]] = [];
                                                } else {
                                                    if (typeof candidate_cp[candidate[1]][candidate[5]] == 'undefined') {
                                                        candidate_cp[candidate[1]][candidate[5]] = [];
                                                    }                                               
                                                }
                                                candidate_cp[candidate[1]][candidate[5]].push([cp, candidate[1], candidate[5], candidate[2], candidate[3], candidate[4], power_up_once, power_up_twice]);     
                                                var data = [cp, true_positive, no_of_crash, accuracy, candidate[1], candidate[5], candidate[2], candidate[3], candidate[4], power_up_once, power_up_twice];
                                                generate_table_row(data, mode);
                                                break;
                                            case 3:
                                                if (typeof candidate_cp[candidate[0]] == 'undefined') {
                                                    candidate_cp[candidate[0]] = [];
                                                    candidate_cp[candidate[0]][candidate[5]] = [];
                                                } else {
                                                    if (typeof candidate_cp[candidate[0]][candidate[5]] == 'undefined') {
                                                        candidate_cp[candidate[0]][candidate[5]] = [];
                                                    }                                                      
                                                }
                                                candidate_cp[candidate[0]][candidate[5]].push([cp, candidate[1], candidate[5], candidate[2], candidate[3], candidate[4], power_up_once, power_up_twice, max_cp[candidate[0]]]);  
                                                var data = [cp, true_positive, no_of_crash, accuracy, candidate[1], candidate[5], candidate[2], candidate[3], candidate[4], power_up_once, power_up_twice, (candidate[0]+1), max_cp[candidate[0]]];
                                                generate_table_row(data, mode);
                                                break;
                                        }
                                    }
                                }
                            }    
                        }
                    }
                    break;                                                                                  
            }
        }
        generate_summarized_table(candidate_cp, mode);
        if (mode == 1){
            coarse_search_string.innerHTML = "Here is the compact version of search string: <br/>";
            generate_search_string(candidate_cp, coarse_search_string, false, 0);
            fine_search_string.innerHTML = "Here is the fine filter version of search string: <br/>";
            generate_search_string(candidate_cp, fine_search_string, true, 0);
            level_search_string.innerHTML = level_search_string.innerHTML + "Here is the search string by level range 1-6: <br/>";
            generate_search_string(candidate_cp.slice(0, 700), level_search_string, true, 0);
            level_search_string.innerHTML = level_search_string.innerHTML + "Here is the search string by level range 7-12: <br/>";
            generate_search_string(candidate_cp.slice(700, 1450), level_search_string, true, 700);
            level_search_string.innerHTML = level_search_string.innerHTML + "Here is the search string by level range 13-18: <br/>";
            generate_search_string(candidate_cp.slice(1450, 2350), level_search_string, true, 1450);
            level_search_string.innerHTML = level_search_string.innerHTML + "Here is the search string by level range 19-24: <br/>";
            generate_search_string(candidate_cp.slice(2350, 3750), level_search_string, true, 2350);
            level_search_string.innerHTML = level_search_string.innerHTML + "Here is the search string by level range 25-30: <br/>";
            generate_search_string(candidate_cp.slice(3750, 5500), level_search_string, true, 3750);
            level_search_string.innerHTML = level_search_string.innerHTML + "Here is the search string by level range 31-35: <br/>";
            generate_search_string(candidate_cp.slice(5500, 8001), level_search_string, true, 5500);
        }
        return;
    }
    
    function appraisal(atk, def, sta) {
        var appraisal_result = [-1, false, false, false, -1];
        var iv_sum = atk+def+sta;
        if (iv_sum < 23) {
            appraisal_result[0] = 0;
        } else if (iv_sum < 30) {
            appraisal_result[0] = 1;
        } else if (iv_sum < 37) {
            appraisal_result[0] = 2;
        } else {
            appraisal_result[0] = 3;
        } 
        var best_stat = Math.max(atk, def, sta)
        if (atk == best_stat) {
            appraisal_result[1] = true;
        }
        if (def == best_stat) {
            appraisal_result[2] = true;
        }      
        if (sta == best_stat) {
            appraisal_result[3] = true;
        }
        if (best_stat < 8) {
            appraisal_result[4] = 0;
        } else if (best_stat < 13) {
            appraisal_result[4] = 1;
        } else if (best_stat < 15) {
            appraisal_result[4] = 2;
        } else {
            appraisal_result[4] = 3;
        }
        return appraisal_result;
    }
    
    function write_table_header(mode) {
        var para = document.createElement("tr");
        var line = document.createElement("th");
        var node;
        switch (mode) {
            case 0:
                node = document.createTextNode("CP List with CP value seen");
                break;
            case 1:
                node = document.createTextNode("CP List with HP, power up dust cost seen");
                break;
            case 2:
                node = document.createTextNode("CP List with appraisal seen");
                break;
            case 3:
                node = document.createTextNode("CP List with level known");
                break;
        }
        line.appendChild(node);
        para.appendChild(line);
        result_table.appendChild(para);
        var para = document.createElement("tr");
        switch (mode) {            
            case 3:            
                var line = document.createElement("th");
                node = document.createTextNode("Level");
                line.appendChild(node);
                para.appendChild(line);
                var line = document.createElement("th");
                node = document.createTextNode("Max CP");
                line.appendChild(node);
                para.appendChild(line);                
            case 2:  
                var line = document.createElement("th");
                node = document.createTextNode("Attack IV");
                line.appendChild(node);    
                para.appendChild(line);
                var line = document.createElement("th");
                node = document.createTextNode("Defense IV");
                line.appendChild(node);
                para.appendChild(line);
                var line = document.createElement("th");
                node = document.createTextNode("Stamina IV");
                line.appendChild(node);  
                para.appendChild(line);         
                var line = document.createElement("th");
                node = document.createTextNode("CP Value of next power up");
                line.appendChild(node);
                para.appendChild(line);
                var line = document.createElement("th");
                node = document.createTextNode("CP Value after 2 power up");
                line.appendChild(node);  
                para.appendChild(line);                            
            case 1:
                var line = document.createElement("th");
                node = document.createTextNode("Power Up Cost");
                line.appendChild(node);  
                para.appendChild(line);   
                var line = document.createElement("th");
                node = document.createTextNode("HP");
                line.appendChild(node); 
                para.appendChild(line);                                                                                  
            case 0:
                var line = document.createElement("th");
                node = document.createTextNode("CP Value");
                line.appendChild(node);
                para.appendChild(line);
                var line = document.createElement("th");
                node = document.createTextNode("True Positive");
                line.appendChild(node);    
                para.appendChild(line);
                var line = document.createElement("th");
                node = document.createTextNode("Total number of combination");
                line.appendChild(node);
                para.appendChild(line);
                var line = document.createElement("th");
                node = document.createTextNode("Accuracy");
                line.appendChild(node);                 
            default:
                para.appendChild(line);
                result_table.appendChild(para);
                break;
        }
    }
    
    function write_summarized_table_header(mode) {
        var para = document.createElement("tr");
        var line = document.createElement("th");
        var node;
        switch (mode) {
            case 0:
                node = document.createTextNode("CP Range with CP value seen");
                break;
            case 1:
                node = document.createTextNode("CP and HP Range with HP, power up dust cost seen");
                break;
            case 2:
                node = document.createTextNode("CP and HP Range with appraisal seen");
                break;
            case 3:
                node = document.createTextNode("CP and HP Range with level known");
                break;
        }
        line.appendChild(node);
        para.appendChild(line);
        summarized_result.appendChild(para);
        var para = document.createElement("tr");
        switch (mode) {          
            case 2:                         
            case 1:
                var line = document.createElement("th");
                node = document.createTextNode("Power Up Cost");
                line.appendChild(node);  
                para.appendChild(line);   
            case 3:
                if (mode == 3){
                    var line = document.createElement("th");
                    node = document.createTextNode("Level");
                    line.appendChild(node); 
                    para.appendChild(line);                 
                }
                var line = document.createElement("th");
                node = document.createTextNode("HP Value");
                line.appendChild(node); 
                para.appendChild(line);                                                                   
            case 0:
                var line = document.createElement("th");
                node = document.createTextNode("CP Range");
                line.appendChild(node);
                para.appendChild(line);
            default:
                summarized_result.appendChild(para);
                break;
        }
    }    
    
    function generate_table_row(data, mode) {
        var para = document.createElement("tr");
        switch (mode) {
            case 3:
                var line = document.createElement("td");
                var node = document.createTextNode(data[11]);
                line.appendChild(node);  
                para.appendChild(line);  
                var line = document.createElement("td");
                var node = document.createTextNode(data[12]);
                line.appendChild(node);  
                para.appendChild(line);                           
            case 2:            
                var line = document.createElement("td");
                var node = document.createTextNode(data[6]);
                line.appendChild(node);
                para.appendChild(line);
                var line = document.createElement("td");
                var node = document.createTextNode(data[7]);
                line.appendChild(node);
                para.appendChild(line);
                var line = document.createElement("td");
                var node = document.createTextNode(data[8]);
                line.appendChild(node);
                para.appendChild(line);
                var line = document.createElement("td");
                var node = document.createTextNode(data[9]);
                line.appendChild(node);
                para.appendChild(line);
                var line = document.createElement("td");
                var node = document.createTextNode(data[10]);
                line.appendChild(node);
                para.appendChild(line);                
            case 1:
                var line = document.createElement("td");
                var node = document.createTextNode(data[4]);
                line.appendChild(node);
                para.appendChild(line);
                var line = document.createElement("td");
                var node = document.createTextNode(data[5]);
                line.appendChild(node);
                para.appendChild(line);                                                                                   
            case 0:
                var line = document.createElement("td");
                var node = document.createTextNode(data[0]);
                line.appendChild(node);
                para.appendChild(line);
                var line = document.createElement("td");
                var node = document.createTextNode(data[1]);
                line.appendChild(node);
                para.appendChild(line);
                var line = document.createElement("td");
                var node = document.createTextNode(data[2]);
                line.appendChild(node);
                para.appendChild(line);
                var line = document.createElement("td");
                var output_str = "" + data[3] + "%";
                var node = document.createTextNode(output_str);
                line.appendChild(node);       
            default:
                para.appendChild(line);
                result_table.appendChild(para);  
                break;
        }        
         return;   
    }
    
    function generate_summarized_table(data, mode) {
        switch (mode) {                                                                  
            case 0:
                var candidate_cp = data;
                var lower_bound = candidate_cp[0];
                var higher_bound = candidate_cp[0];
                for (var count = 1; count < candidate_cp.length; ++count){
                    var cp = candidate_cp[count];
                    if (higher_bound < (cp-1)) {
                        var para = document.createElement("tr");
                        var line = document.createElement("td");
                        var node;
                        if (lower_bound == higher_bound){
                            node = document.createTextNode(lower_bound);
                        } else {
                            var output_str = "" + lower_bound + "-" + higher_bound;
                            node = document.createTextNode(output_str);
                        }
                        line.appendChild(node);
                        para.appendChild(line);
                        summarized_result.appendChild(para); 
                        lower_bound = cp;
                        higher_bound = cp;
                    } else {
                        higher_bound = cp;
                    }
                }
                var para = document.createElement("tr");
                var line = document.createElement("td");
                if (lower_bound == higher_bound){
                    node = document.createTextNode(lower_bound);
                } else {
                    var output_str = "" + lower_bound + "-" + higher_bound;
                    node = document.createTextNode(output_str);
                }
                line.appendChild(node);
                para.appendChild(line);
                summarized_result.appendChild(para); 
                break;
            case 1:
            case 2:
                var candidate_cp = data;
                for (var count = 0; count < power_up_cost.length; ++count){
                    var dust_level = power_up_cost[count];
                    for (var hp = 1; hp < 1000; ++hp){
                        if (typeof candidate_cp[dust_level][hp] == 'undefined') {
                            continue;
                        } else {
                            var para = document.createElement("tr");
                            var line = document.createElement("td");
                            var node = document.createTextNode(dust_level);
                            line.appendChild(node);
                            para.appendChild(line);  
                            var line = document.createElement("td");
                            var node = document.createTextNode(hp);
                            line.appendChild(node);
                            para.appendChild(line); 
                            var line = document.createElement("td");  
                            var output_str = "";
                            var candidate_cp = data;
                            var lower_bound = candidate_cp[dust_level][hp][0][0];
                            var higher_bound = candidate_cp[dust_level][hp][0][0];                                                   
                            for (var count_inner = 1; count_inner < candidate_cp[dust_level][hp].length; ++count_inner){
                                var cp = candidate_cp[dust_level][hp][count_inner][0];
                                if (higher_bound < (cp-1)) {
                                    if (lower_bound == higher_bound){
                                        output_str = output_str + lower_bound + ", ";
                                    } else {
                                        output_str = output_str + lower_bound + "-" + higher_bound + ", ";
                                    }
                                    lower_bound = cp;
                                    higher_bound = cp;
                                } else {
                                    higher_bound = cp;
                                }
                            }
                            if (lower_bound == higher_bound){
                                output_str = output_str + lower_bound;
                            } else {
                                output_str = output_str + lower_bound + "-" + higher_bound;
                            }
                            var node = document.createTextNode(output_str);
                            line.appendChild(node);
                            para.appendChild(line);
                            summarized_result.appendChild(para); 
                            if (mode == 2){
                                var para = document.createElement("tr");
                                var line = document.createElement("th");
                                var node = document.createTextNode("");
                                line.appendChild(node);
                                para.appendChild(line);                                  
                                var line = document.createElement("th");
                                var node = document.createTextNode("CP Value");
                                line.appendChild(node);
                                para.appendChild(line);  
                                var line = document.createElement("th");
                                var node = document.createTextNode("Atk IV");
                                line.appendChild(node);
                                para.appendChild(line); 
                                var line = document.createElement("th");
                                var node = document.createTextNode("Def IV");
                                line.appendChild(node);
                                para.appendChild(line); 
                                var line = document.createElement("th");
                                var node = document.createTextNode("Sta IV");
                                line.appendChild(node);
                                para.appendChild(line); 
                                var line = document.createElement("th");
                                var node = document.createTextNode("CP at next power up");
                                line.appendChild(node);
                                para.appendChild(line);       
                                var line = document.createElement("th");
                                var node = document.createTextNode("CP after 2 power up");
                                line.appendChild(node);
                                para.appendChild(line); 
                                var line = document.createElement("th");
                                node = document.createTextNode("Overall IV");
                                line.appendChild(node);
                                para.appendChild(line);                
                                var line = document.createElement("th");
                                node = document.createTextNode("Best stat(s)");
                                line.appendChild(node);
                                para.appendChild(line);
                                var line = document.createElement("th");
                                node = document.createTextNode("Range of best IV(s) stat");
                                line.appendChild(node);
                                para.appendChild(line);                                  
                                summarized_result.appendChild(para); 
                                for (var count_inner = 0; count_inner < candidate_cp[dust_level][hp].length; ++count_inner){
                                    var para = document.createElement("tr");
                                    var stat = candidate_cp[dust_level][hp][count_inner];
                                    var line = document.createElement("td");
                                    var node = document.createTextNode("");
                                    line.appendChild(node);
                                    para.appendChild(line);                                    
                                    var line = document.createElement("td");
                                    var node = document.createTextNode(stat[0]);
                                    line.appendChild(node);
                                    para.appendChild(line);
                                    var line = document.createElement("td");
                                    var node = document.createTextNode(stat[3]);
                                    line.appendChild(node);
                                    para.appendChild(line);
                                    var line = document.createElement("td");
                                    var node = document.createTextNode(stat[4]);
                                    line.appendChild(node);
                                    para.appendChild(line);
                                    var line = document.createElement("td");
                                    var node = document.createTextNode(stat[5]);
                                    line.appendChild(node);
                                    para.appendChild(line);     
                                    var line = document.createElement("td");
                                    var node = document.createTextNode(stat[6]);
                                    line.appendChild(node);
                                    para.appendChild(line);     
                                    var line = document.createElement("td");
                                    var node = document.createTextNode(stat[7]);
                                    line.appendChild(node);
                                    para.appendChild(line);
                                    var appraisal_result = appraisal(stat[3], stat[4], stat[5]);
                                    generate_appraisal_report_and_print(appraisal_result, para);
                                }                                                                                                                      
                            }
                        }
                    }
                }
                break;  
            case 3: 
                var candidate_cp = data;
                for (var level = 0; level < 35; ++level){
                    for (var hp = 1; hp < 1000; ++hp){
                        if (typeof candidate_cp[level][hp] == 'undefined') {
                            continue;
                        } else {
                            var para = document.createElement("tr");
                            var line = document.createElement("td");
                            var node = document.createTextNode((level+1));
                            line.appendChild(node);
                            para.appendChild(line);  
                            var line = document.createElement("td");
                            var node = document.createTextNode(hp);
                            line.appendChild(node);
                            para.appendChild(line); 
                            var line = document.createElement("td");  
                            var output_str = "";
                            var candidate_cp = data;
                            var lower_bound = candidate_cp[level][hp][0][0];
                            var higher_bound = candidate_cp[level][hp][0][0];                                                   
                            for (var count_inner = 1; count_inner < candidate_cp[level][hp].length; ++count_inner){
                                var cp = candidate_cp[level][hp][count_inner][0];
                                if (higher_bound < (cp-1)) {
                                    if (lower_bound == higher_bound){
                                        output_str = output_str + lower_bound + ", ";
                                    } else {
                                        output_str = output_str + lower_bound + "-" + higher_bound + ", ";
                                    }
                                    lower_bound = cp;
                                    higher_bound = cp;
                                } else {
                                    higher_bound = cp;
                                }
                            }
                            if (lower_bound == higher_bound){
                                output_str = output_str + lower_bound;
                            } else {
                                output_str = output_str + lower_bound + "-" + higher_bound;
                            }
                            var node = document.createTextNode(output_str);
                            line.appendChild(node);
                            para.appendChild(line);
                            summarized_result.appendChild(para); 
                            var para = document.createElement("tr");
                            var line = document.createElement("th");
                            var node = document.createTextNode("");
                            line.appendChild(node);
                            para.appendChild(line);                                  
                            var line = document.createElement("th");
                            var node = document.createTextNode("CP Value");
                            line.appendChild(node);
                            para.appendChild(line);  
                            var line = document.createElement("th");
                            var node = document.createTextNode("Max CP");
                            line.appendChild(node);
                            para.appendChild(line);                                 
                            var line = document.createElement("th");
                            var node = document.createTextNode("Atk IV");
                            line.appendChild(node);
                            para.appendChild(line); 
                            var line = document.createElement("th");
                            var node = document.createTextNode("Def IV");
                            line.appendChild(node);
                            para.appendChild(line); 
                            var line = document.createElement("th");
                            var node = document.createTextNode("Sta IV");
                            line.appendChild(node);
                            para.appendChild(line); 
                            var line = document.createElement("th");
                            var node = document.createTextNode("CP at next power up");
                            line.appendChild(node);
                            para.appendChild(line);       
                            var line = document.createElement("th");
                            var node = document.createTextNode("CP after 2 power up");
                            line.appendChild(node);
                            para.appendChild(line); 
                            var line = document.createElement("th");
                            node = document.createTextNode("Overall IV");
                            line.appendChild(node);
                            para.appendChild(line);                
                            var line = document.createElement("th");
                            node = document.createTextNode("Best stat(s)");
                            line.appendChild(node);
                            para.appendChild(line);
                            var line = document.createElement("th");
                            node = document.createTextNode("Range of best IV(s) stat");
                            line.appendChild(node);
                            para.appendChild(line);                             
                            summarized_result.appendChild(para); 
                            for (var count_inner = 0; count_inner < candidate_cp[level][hp].length; ++count_inner){
                                var para = document.createElement("tr");
                                var stat = candidate_cp[level][hp][count_inner];
                                var line = document.createElement("td");
                                var node = document.createTextNode("");
                                line.appendChild(node);
                                para.appendChild(line);                                    
                                var line = document.createElement("td");
                                var node = document.createTextNode(stat[0]);
                                line.appendChild(node);
                                para.appendChild(line);
                                var line = document.createElement("td");
                                var node = document.createTextNode(stat[8]);
                                line.appendChild(node);
                                para.appendChild(line);                                     
                                var line = document.createElement("td");
                                var node = document.createTextNode(stat[3]);
                                line.appendChild(node);
                                para.appendChild(line);
                                var line = document.createElement("td");
                                var node = document.createTextNode(stat[4]);
                                line.appendChild(node);
                                para.appendChild(line);
                                var line = document.createElement("td");
                                var node = document.createTextNode(stat[5]);
                                line.appendChild(node);
                                para.appendChild(line);     
                                var line = document.createElement("td");
                                var node = document.createTextNode(stat[6]);
                                line.appendChild(node);
                                para.appendChild(line);     
                                var line = document.createElement("td");
                                var node = document.createTextNode(stat[7]);
                                line.appendChild(node);
                                para.appendChild(line);                                                                                                                                                                                
                                var appraisal_result = appraisal(stat[3], stat[4], stat[5]);
                                generate_appraisal_report_and_print(appraisal_result, para);
                            }
                        }
                    }
                }
                break;                       
        }        
         return; 
    }
    
    function generate_appraisal_report_and_print(appraisal_result, para) {
        switch (appraisal_result[0]) {
            case 0:
                var line = document.createElement("td");
                var node = document.createTextNode("0-22/0%-48.9%");
                line.appendChild(node);
                para.appendChild(line);
                break;
            case 1:
                var line = document.createElement("td");
                var node = document.createTextNode("23-29/51.1%-64.4%");
                line.appendChild(node);
                para.appendChild(line);
                break;
            case 2:
                var line = document.createElement("td");
                var node = document.createTextNode("30-36/66.7%-80%");
                line.appendChild(node);
                para.appendChild(line);
                break;
            case 3:
                var line = document.createElement("td");
                var node = document.createTextNode("37-45/82.2%-100%");
                line.appendChild(node);
                para.appendChild(line);   
                break;                                                                                                                                 
        }
        var line = document.createElement("td");
        var output_str = "";
        if (appraisal_result[1]){
            output_str = output_str + "Atk" + ", ";
        }
        if (appraisal_result[2]){
            output_str = output_str + "Def" + ", ";
        }
        if (appraisal_result[3]){
            output_str = output_str + "Sta" + ", ";
        }   
        output_str = output_str.substring(0, output_str.length-2);                                                                   
        var node = document.createTextNode(output_str);
        line.appendChild(node);
        para.appendChild(line); 
        switch (appraisal_result[4]) {
            case 0:
                var line = document.createElement("td");
                var node = document.createTextNode("0-7");
                line.appendChild(node);
                para.appendChild(line);
                break;
            case 1:
                var line = document.createElement("td");
                var node = document.createTextNode("8-12");
                line.appendChild(node);
                para.appendChild(line);
                break;
            case 2:
                var line = document.createElement("td");
                var node = document.createTextNode("13,14");
                line.appendChild(node);
                para.appendChild(line);
                break;
            case 3:
                var line = document.createElement("td");
                var node = document.createTextNode("15");
                line.appendChild(node);
                para.appendChild(line);
                break;                                                                                                                                    
        }
        summarized_result.appendChild(para);
    }
    
    function show_compact_list() {
        summarized_result.style.display = "block";
        coarse_search_string.style.display = "block";
        fine_search_string.style.display = "block";
        level_search_string.style.display = "block";
        return;
    }
    
    function generate_search_string(data, search_string, fine, start_position) {
        var pokemon_entry_no = parseInt(species.value);
        var dex_number = pokedex[pokemon_entry_no];
        var candidate_cp = data;
        var hp_only = [];
        for (var count = 0; count < power_up_cost.length; ++count){
            var dust_level = power_up_cost[count] - start_position;
            if (typeof candidate_cp[dust_level]== 'undefined') {
                continue;
            }
            for (var hp = 1; hp < 1000; ++hp){
                if (typeof candidate_cp[dust_level][hp] == 'undefined') {
                    continue;
                } else {
                    for (var count_inner = 0; count_inner < candidate_cp[dust_level][hp].length; ++count_inner){
                        var candidate_sublist = candidate_cp[dust_level][hp][count_inner];
                        if (typeof hp_only[hp] == 'undefined') {
                            hp_only[hp] = [];
                        }
                        hp_only[hp].push(candidate_sublist);
                    }
                }
            }
        }
        //data = [];
        for (var hp = 1; hp < 1000; ++hp){ 
            if (typeof hp_only[hp] == 'undefined') {
                continue;
            } else {
                var cp_list = [];
                for (var count = 0; count < hp_only[hp].length; ++count){
                    cp_list[hp_only[hp][count][0]] = true;
                }
                hp_only[hp] = cp_list;
            }
        }
        var all_checked = true;
        while (true) {
            all_checked = true;
            var hp_candidate = [];
            var cp_candidate = [];
            for (var hp = 1; hp < 1000; ++hp){
                if (typeof hp_only[hp] == 'undefined') {
                    continue;
                } else {
                    if (hp_only[hp].length == 0) {
                        continue;
                    } else {
                        all_checked = false;
                        var cp_list = hp_only[hp];
                        var overlap = false;
                        for (count = 1; count < 4000; ++count){
                            if (cp_list[count] && cp_candidate[count]) {
                                overlap = true;
                            }
                        }
                        if (overlap && fine) {
                            continue;
                        } else {
                            for (count = 1; count < 4000; ++count){
                                if (cp_list[count]) {
                                    cp_candidate[count] = true;
                                }
                            } 
                            hp_candidate.push(hp);
                        } 
                        hp_only[hp] = [];     
                    }             
                }
            }
            if (all_checked) {
                break;
            }
            search_string.innerHTML = search_string.innerHTML + dex_number + "&";
            var lower_bound = hp_candidate[0];
            var higher_bound = hp_candidate[0]; 
            for (var count = 1; count < hp_candidate.length; ++count){
                var hp = hp_candidate[count];
                if (higher_bound < (hp-1)) {
                    if (lower_bound == higher_bound){
                        search_string.innerHTML = search_string.innerHTML + "HP" + lower_bound + ",";
                    } else {
                        search_string.innerHTML = search_string.innerHTML + "HP" + lower_bound + "-" + higher_bound + ",";
                    }
                    lower_bound = hp;
                    higher_bound = hp;
                } else {
                    higher_bound = hp;
                }
            } 
            if (lower_bound == higher_bound){
                search_string.innerHTML = search_string.innerHTML + "HP" + lower_bound + "&";
            } else {
                search_string.innerHTML = search_string.innerHTML + "HP" + lower_bound + "-" + higher_bound + "&";
            }
            
            var lower_bound = -1;
            var higher_bound = 10;
            for (var cp = 10; cp < 5000; ++cp){
                if (cp_candidate[cp]) {
                    higher_bound = cp;
                    if (lower_bound == -1) {
                        lower_bound = cp;
                    } 
                } else {
                    if (lower_bound > 0) {
                        if (lower_bound == higher_bound){
                            search_string.innerHTML = search_string.innerHTML + "CP" + lower_bound + ",";
                        } else {
                            search_string.innerHTML = search_string.innerHTML + "CP" + lower_bound + "-" + higher_bound + ",";
                        }
                        lower_bound = -1;
                    }
                }
            } 
            if (lower_bound > 0) {
                if (lower_bound == higher_bound){
                    search_string.innerHTML = search_string.innerHTML + "CP" + lower_bound;
                } else {
                    search_string.innerHTML = search_string.innerHTML + "CP" + lower_bound + "-" + higher_bound;
                }
                lower_bound = -1;
            } else {
                search_string.innerHTML = search_string.innerHTML.substring(0, search_string.innerHTML.length-1);
            }
            search_string.innerHTML = search_string.innerHTML + "<br/> <br/>"; 
        }  
    }
    
    
    
</script>

</body>	
</html>